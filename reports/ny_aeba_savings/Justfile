# =============================================================================
# DEFAULT
# =============================================================================
# If you run `just`, you see all available commands
default:
    @just --list

# =============================================================================
# LIBREOFFICE
# =============================================================================

# Ensure LibreOffice is available (installs if missing)
ensure-libreoffice:
    ./install-libreoffice.sh

# =============================================================================
# MODEL
# =============================================================================

# Fail if model.py or data/*.yaml have uncommitted changes
_check-committed:
    #!/usr/bin/env bash
    set -euo pipefail
    dirty=$(git diff --name-only HEAD -- model.py 'data/*.yaml')
    untracked=$(git ls-files --others --exclude-standard -- model.py 'data/*.yaml')
    files="${dirty}${untracked}"
    if [ -n "$files" ]; then
        echo "Error: uncommitted changes in model or data files:" >&2
        echo "$files" >&2
        exit 1
    fi

# Run the model (after verifying inputs are committed)
run: _check-committed
    uv run python model.py

# Run the model without commit check (use during development)
run-dev:
    uv run python model.py

# =============================================================================
# TESTING
# =============================================================================

# Run tests for this report (installs LibreOffice if needed)
test: ensure-libreoffice
    uv run python -m pytest tests/test_ny_aeba_model.py -v
