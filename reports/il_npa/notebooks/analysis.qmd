---
title: Peoples Gas Construction Impact Analysis

toc: true
reference-location: margin
fig-cap-location: bottom

appendix-style: default
citation-location: document
citation:
  container-title: Switchbox

format:
  html:
    page-layout: full
---

```{python}
import geopandas as gpd
import pandas as pd
from pathlib import Path
from datetime import datetime
import polars as pl

# Set paths
data_dir = Path('../data')
geo_data_dir = data_dir / 'geo_data'
utils_dir = Path('../utils')
```

```{python}

# Find the most recent summary GeoJSON file exported from geo_data_cleaning
geojson_files = sorted(data_dir.glob('peoplesgas_with_buildings_streets_*.geojson'))

if geojson_files:
    latest_geojson = geojson_files[-1]
    print(f"Reading summary GeoJSON: {latest_geojson.name}")
    pg_summary = gpd.read_file(latest_geojson)
    print(f"Loaded {len(pg_summary)} construction polygons with summary statistics")
else:
    print("No summary GeoJSON found. Please run the geo_data_cleaning notebook to generate it.")
    pg_summary = None

```


```{python}
# Read from the first sheet of the Google Sheet using polars
# Use export URL format instead of edit URL
gsheet_url = "https://docs.google.com/spreadsheets/d/1xxa47dClvp0rosZhUP1R7790CNXMLSD_0ExrPccR3p0/export?format=csv&gid=0"

prp_df = pl.read_csv(gsheet_url)

prp_df

```


```{python}
#cost estimates
cost_lpp_mile = prp_df.filter(
    pl.col('variable') == 'cost_lpp_mile')['value'][0]
cost_lpp_mile

cost_elec_sf = prp_df.filter(pl.col('variable') == 'cost_elec_sf')['value'][0]
cost_elec_mf = prp_df.filter(pl.col('variable') == 'cost_elec_mf')['value'][0]

```

```{python}
# Ensure all cost variables are numeric (float)
cost_lpp_mile = float(cost_lpp_mile)
cost_elec_sf = float(cost_elec_sf)
cost_elec_mf = float(cost_elec_mf)


pg_summary['lpp_cost'] = pg_summary['street_miles'] * cost_lpp_mile

pg_summary['elec_sf_cost'] = pg_summary['sf_parcels'] * cost_elec_sf
pg_summary['elec_mf_cost'] = pg_summary['mf_units'] * cost_elec_mf

pg_summary['elec_cost_total'] = pg_summary['elec_sf_cost'] + \
    pg_summary['elec_mf_cost']

pg_summary['comm_ind_total_count'] = pg_summary['commercial_parcels'] + \
    pg_summary['industrial_parcels']

pg_summary['comm_ind_flag'] = pg_summary['comm_ind_total_count'] > 0

pg_summary['lpp_over_npa'] = pg_summary['lpp_cost'] / \
    pg_summary['elec_cost_total']

```

```{python}
# Calculate the percent of polygons where npa_over_lpp > 1
num_gt_1 = (pg_summary['lpp_over_npa'] > 1).sum()
total_polygons = len(pg_summary)
percent_gt_1 = (num_gt_1 / total_polygons) * 100

print(f"{percent_gt_1:.1f}% of construction polygons have npa_over_lpp > 1")

```

```{python}

# Calculate the percent of polygons where comm_ind_flag == False
num_comm_ind_false = (pg_summary['comm_ind_flag'] == False).sum()
percent_comm_ind_false = (num_comm_ind_false / len(pg_summary)) * 100
print(f"{percent_comm_ind_false:.1f}% of construction polygons have comm_ind_flag == False")

```

```{python}
# Calculate the percent of polygons where lpp_over_npa > 1 and comm_ind_flag == False
num_gt_1_and_comm_ind_false = (pg_summary['lpp_over_npa'] > 1) & (pg_summary['comm_ind_flag'] == False).sum()
percent_gt_1_and_comm_ind_false = (num_gt_1_and_comm_ind_false.sum() / len(pg_summary)) * 100
print(f"{percent_gt_1_and_comm_ind_false:.1f}% of construction polygons have lpp_over_npa > 1 and comm_ind_flag == False")
```
